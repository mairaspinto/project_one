mrconvert /home/visionlab/Desktop/dMRI_data_harmonization/UZA/DTI-gibbs/UZA_7sBn847_DTI_denoised_gibbs.mif /home/visionlab/uantwerp_lab/first_project/src/examplepackage/dwipreproc-tmp-B7A4ET/dwi.mif
mrconvert dwi.mif - | dwiextract - se_epi.mif -bzero
mrinfo dwi.mif -export_grad_mrtrix grad.b
mrconvert se_epi.mif -coord 2 74 - | mrcat se_epi.mif - se_epi_pad2.mif -axis 2
mrconvert dwi.mif -coord 2 74 - | mrcat dwi.mif - dwi_pad2.mif -axis 2
mrconvert se_epi_pad2.mif topup_in.nii -strides -1,+2,+3,+4 -export_pe_table topup_datain.txt
topup --imain=topup_in.nii --datain=topup_datain.txt --out=field --fout=field_map.nii.gz --config=/usr/local/fsl/etc/flirtsch/b02b0.cnf
mrinfo dwi_pad2.mif -export_pe_eddy applytopup_config.txt applytopup_indices.txt
dwiextract dwi_pad2.mif -pe -1,0,0,0.0499 - | mrconvert - dwi_pad2_pe_1.nii -json_export dwi_pad2_pe_1.json
applytopup --imain=dwi_pad2_pe_1.nii --datain=applytopup_config.txt --inindex=1 --topup=field --out=dwi_pad2_pe_1_applytopup.nii --method=jac
mrconvert dwi_pad2_pe_1_applytopup.nii.gz dwi_pad2_pe_1_applytopup.mif -json_import dwi_pad2_pe_1.json
dwiextract dwi_pad2.mif -pe 0,-1,0,0.0499 - | mrconvert - dwi_pad2_pe_2.nii -json_export dwi_pad2_pe_2.json
applytopup --imain=dwi_pad2_pe_2.nii --datain=applytopup_config.txt --inindex=2 --topup=field --out=dwi_pad2_pe_2_applytopup.nii --method=jac
mrconvert dwi_pad2_pe_2_applytopup.nii.gz dwi_pad2_pe_2_applytopup.mif -json_import dwi_pad2_pe_2.json
dwiextract dwi_pad2.mif -pe 0,1,0,0.0495 - | mrconvert - dwi_pad2_pe_3.nii -json_export dwi_pad2_pe_3.json
applytopup --imain=dwi_pad2_pe_3.nii --datain=applytopup_config.txt --inindex=3 --topup=field --out=dwi_pad2_pe_3_applytopup.nii --method=jac
mrconvert dwi_pad2_pe_3_applytopup.nii.gz dwi_pad2_pe_3_applytopup.mif -json_import dwi_pad2_pe_3.json
mrcat dwi_pad2_pe_1_applytopup.mif dwi_pad2_pe_2_applytopup.mif dwi_pad2_pe_3_applytopup.mif - -axis 3 | dwi2mask - - | maskfilter - dilate - | mrconvert - eddy_mask.nii -datatype float32 -strides -1,+2,+3
mrconvert dwi_pad2.mif eddy_in.nii -strides -1,+2,+3,+4 -export_grad_fsl bvecs bvals -export_pe_eddy eddy_config.txt eddy_indices.txt
eddy_cuda --imain=eddy_in.nii --mask=eddy_mask.nii --acqp=eddy_config.txt --index=eddy_indices.txt --bvecs=bvecs --bvals=bvals --topup=field --slm=linear --out=dwi_post_eddy
